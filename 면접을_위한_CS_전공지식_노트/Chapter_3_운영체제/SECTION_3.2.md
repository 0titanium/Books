## 3.2 메모리

메모리 계층 구조와 메모리 관리

## 3.2.1 메모리 계층

- 레지스터 : CPU 내부 작은 메모리. 휘발성, 가장 빠른 속도, 기억 용량 가장 적음

- 캐시 : L1, L2 캐시. 휘발성, 빠른 속도.

- 주기억장치 : RAM. 휘발성, 보통 속도, 보통 기억 용량.

- 보조기억장치 : HDD, SDD. 비휘발성, 낮은 속도, 많은 기억 용량.

## 캐시

데이터를 미리 복사해놓는 임시 저장소.

빠른 장치, 느린 장치 사이에서 속도 차에 따른 병목 현상을 줄이기 위한 메모리.

메모리 - 레지스터(캐싱 계층) - CPU. 속도 차 해결.

## 지역성 원리

캐시를 직접 설정할 땐 자주 사용하는 데이터 기반으로 설정.

자주 사용의 기준이 지역성.

시간 지역성, 공간 지역성으로 나뉨.

### 시간 지역성

최근 사용 데이터에 접근하려는 특성.

### 공간 지역성

최근 접근한 데이터를 이루고 있는 공간, 그 가까운 공간에 접근하는 특성.

### 캐시 히트

캐시에서 원하는 데이터를 찾음

제어장치를 거치기 때문에 가까운 위치, CPU 내부 버스 이용 때문에 빠름 

### 캐시 미스

캐시에서 원하는 데이터 못찾음 -> 주 메모리에서 찾아옴

시스템 버스 기반 작동 때문에 느림

## 캐시 매핑

캐시가 히트되기 위해 매핑하는 방법

CPU 레지스터, 주 메모리 간 데이터 전달을 기반

- 직접 매핑 : 한 메모리 위치에 한 캐시 위치 매핑

- 연관 매핑 : 순서 상관없이 관련있는 캐시와 메모리 매핑

- 집합 연관 매핑 : 순서 일치. 캐시의 집합 내 무작위로 데이터 저장해 메모리 매핑

## 가상 메모리

실제 이용 가능한 메모리를 추상화하여 더 큰 메모리로 보이게 하는 방법

가상 주소와 실제 주소로 나뉨.

가상 주소는 메모리관리장치(MMU)에 의해 실제 주소로 변환됨

## 메모리 할당

시작 메모리 위치와 메모리 할당 크기를 기반으로 프로그램을 메모리에 할당

- 연속 할당 : 메모리에 연속된 공간을 할당. 여러 프로세스를 순차적으로 공간에 할당

    - 고정 분할 방식 : 메모리를 미리 나누어 관리. 내부 단편화 발생.

    - 가변 분할 방식 : 프로그램 크기에 따라 동적 관리. 외부 단편화 발생 가능성.

        - 최초 적합 : 위나 아래에서 시작해 찾은 홀에 바로 할당
        - 최적 적합 : 프로세스 크기 이상 중 가장 작은 홀에 할당
        - 최악 적합 : 프로세스와 가장 크기 차이가 나는 홀에 할당

- 불연속 할당 : 메모리에 연속되지 않게 공간을 할당

    - 페이징 : 메모리를 같은 크기의 페이지로 나눠 다른 위치에 프로세스를 할당. 주소 변환이 복잡

    - 세그멘테이션 : 의미 단위인 세그먼트로 나눠 할당. 공유와 보안이 장점. 홀 크기가 불균일한 것이 단점.

    - 페이지드 세그멘테이션 : 프로세스를 세그먼트로 나누고 세그먼트를 페이지 단위로 나눠 할당.

### 메모리 단편화

- 내부 단편화 : 메모리를 나눈 크기보다 프로그램이 작아서 못들어가는 공간이 많이 발생하는 현상

- 외부 단편화 : 메모리를 나눈 크기보다 프로그램이 커서 못들어가는 공간이 많이 발생하는 현상

- 홀 : 할당 가능한 빈 메모리 공간


## 페이지 교체 알고리즘

- FIFO(First In First Out) : 교체 영역에 먼저 온 페이지를 먼저 놓는 방법

- LRU(Leaset Recently Used) : 참조가 가장 오래된 페이지를 바꾸는 방법

- NUR(Not Used Recently) : 0(비참조), 1(최근 참조) 비트를 이용. 시계 방향으로 돌면서 0을 찾으면 프로세스를 교체하고 1로 바꿈.

- LFU(Least Frequentyl Used) : 참조 회수가 가장 적은 페이지를 교체.