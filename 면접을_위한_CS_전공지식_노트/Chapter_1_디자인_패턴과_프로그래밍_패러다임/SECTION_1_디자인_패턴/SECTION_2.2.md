## 2.2 TCP/IP 4계층 모델

인터넷 프로토콜 스위트(internet protocol suite): 인터넷에서 컴퓨터들이 정보를 주고 받는데 쓰이는 프로토콜 집합.

TCP/IP 4계층 모델이나 OSI 7 계층 모델로 설명.

TCP/IP 4계층 모델 : 네트워크에서 사용되는 통신 프로토콜 집합. 프로토콜 네트워킹 범위에 따라 네 추상화 계층으로 구성.

## 2.2.1 계층 구조

### 애플리케이션 계층

FTP, HTTP, SSH, SMTP, DNS 등 으용 프로그램이 사용되는 프로토콜 계층. 웹, 이메일 등 실질적으로 서비스 제공 계층.

### FTP

장치 간 파일 전송에 사용되는 표준 통신 프로토콜.

### SSH

보안없는 네트워크에서 서비스 운영을 위한 암호화 네트워크 프로토콜.

### HTTP

www를 위한 데이터 통신의 기초. 웹 이용에 쓰는 프로토콜.

### SMTP

메일 전송을 위한 인터넷 표준 통신 프로토콜.

### DNS

도메인 네임과 IP 주소를 매칭해주는 서버.

예시)

www.naver.com으로 DNS 쿼리 도착

[Root DNS] -> [.com DNS] -> [.naver DNS] -> [.www DNS]를 거쳐 완벽한 주소를 찾아 IP 주소 매핑.

IP 주소가 바뀌어도 사용자들은 똑같은 도메인 주소로 찾아갈 수 있다.

### 전송 계층

송신자와 수신자를 연결하는 통신 서비스 제공.

연결 지향 데이터 스트림 지원.

신뢰성 흐름 제어 제공.

애플리케이션과 인터넷 계층 사이의 데이터 전달 시 중계 역할.

TCP : 패킷 사이 순서 보장. 연결 지향 프로토콜 사용으로 신뢰성 구축, 수신 여부 확인. 가상회선 패킷 교환 방식 사용.

UDP : 순서 보장 안함. 수신 여부 확인 안함. 데이터만 주는 데이터그램 패킷 교환 방식 사용.

#### 가상회선 패킷 교환 방식

각 패킷에 가상회선 식별자 포함. 모든 패킷 전송 시 가상회선 해제. 패킷들은 전송된 순서대로 도착.

#### 데이터그램 패킷 교환 방식

패킷이 독립적으로 이동, 최적 경로 선택.

하나의 메시지에서 분리된 패킷들이 다른 경로로 전송 될 수 있음.

도착한 순서가 다를 수 있음.

#### TCP 연결 성립 과정

신뢰성 확보 시 3 웨이 핸드 셰이크(3-way handshake) 작업 진행.

- SYN 단계 : 클라이언트가 서버에 ISN을 담아 SYN을 보냄.
    - ISN : 새 TCP 연결의 첫 패킷에 할당된 임의의 시퀀스. 장치마다 다를 수도.

- SYN + ACK 단계 : 서버는 클라이언트의 SYN 수신. 서버의 ISN 전송. 클라이너트의 ISN + 1 전송.

- ACK 단계 : 클라이언트는 서버의 승인번호(ISN + 1)를 담아 ACK를 서버에 전송.

#### SYN

SYNchronization. 연결 요청 플래그.

#### ACK

ACKnowledgement. 응답 플래그.

#### ISN

Initial Sequence Numbers. 초기 네트워크 연결 시 할당 된 32비트 고유 시퀀스 번호.

#### TCP 연결 해제 과정.

4-웨이 핸드 셰이크 발생.

1. 클라이언트가 연결 닫기 시도 시 FIN으로 설정된 세그먼트 전송. 그런 다음 클라이언트는 FIN_WAIT_1 상태가 되어 서버 응답 대기.

2. 서버가 클라이언트에게 ACK(승인 세그먼트) 전송. 그런 다음 CLOSE_WAIT 상태 돌입. 클라이언트가 세그먼트 받으면 FIN_WAIT_2 상태 돌입.

3. 서버가 ACK를 전송 보내고 일정 시간 후 클라이언트에 FIN(세그먼트) 전송.

4. 클라이언트는 TIME_WAIT 상태 돌입. 서버로 ACK 전송. 서버 CLOSED 상태 돌입. 클라이언트는 일정 시간 대기 후 연결 닫음. 클라이언트와 서버의 모든 자원 연결 해제.

TIME_WAIT. 일정 시간 후 연결 닫는 이유.

- 지연 패킷 발생 대비. 지연 패킷 처리 실패 시 데이터 무결성이 훼손됨.

- 두 장치 연결 닫힘 확인. LAST_ACK 상태에서 닫히면 새 연결 시 계속 LAST_ACK 상태라 접속 오류 발생.

#### TIME_WAIT

소켓이 일정 시간 유지 후 소멸. 지연 패킷 문제점 해결에 사용. 시간은 OS마다 다를 수 있다.

#### 데이터 무결성(data integrity)

데이터 정확성과 일관성 유지, 보증.

### 인터넷 계층

장치로부터 받은 네트워크 패킷을 IP 주소로 지정된 목적지에 전송하기 위해 사용하는 계층.

IP, ARP, ICMP 등이 있음. 패킷 수신할 상대의 주소를 지정하여 데이터 전달. 상대가 제대로 받았는지 보장하지 않음(비연결형적 특징).

### 링크 계층

전선, 광섬유, 무선 등 실질적 데이터 전달, 장치 간 신호 송수신하는 규칙을 정하는 계층. 네트워크 접근 계층이라고도 함.

물리 계층, 데이터 링크 계층으로 나누기도 함.

물리 계층 : 무선 LAN, 유선 LAN을 통해 0, 1로 이뤄진 데이터 전송 계층.

데이터 링크 계층 : 이더넷 프레임으로 에러 확인, 흐름 제어, 접근 제어 담당하는 계층.

### 계층 간 데이터 송수신 과정

예시) HTTP를 통해 웹 서버에 있는 데이터를 요청했을 때

애플리케이션 계층 -> 리퀘스트 캡슐화 -> 링크 계층. 서버와 통신.

링크 계층 -> 애플리케이션까지 비캡술화 과정으로 데이터 전송.

### 2.2.2 PDU(Protocol Data Unit)

네트워크의 어느 계층에서 계층으로 전달되는 데이터 한 덩어리의 단위.

헤더 : 제어 관련 정보 포함된 것.

페이로드 : 데이터.

계층마다 명칭이 다름.

- 애플리케이션 계층 : 메시지. HTTP 헤더(문자열). authorization 등 다른 값을 넣는 확장이 쉬워서 문자열 사용.

- 전송 계층 : 세그먼트(TCP), 데이터그램(UDP)

- 인터넷 계층 : 패킷

- 링크 계층 : 프레임(데이터 링크 계층), 비트(물리 계층)

PDU 중 아래 계층인 비트로 송수신하는 것이 PDU 중 가장 빠르고 효율성 높음.